<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ø¯Ø±Ø³Ø© Ø¹Ù…Ø±</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<style>
body {
    font-family: "Cairo", sans-serif;
    background: linear-gradient(135deg, #396afc, #2948ff);
    margin:0; padding:0; color:white; text-align:center;
}
.container {
    margin:40px auto; background:white; color:#333; width:90%; max-width:500px;
    padding:25px; border-radius:15px; box-shadow:0 4px 15px rgba(0,0,0,0.3);
}
input { width:90%; padding:12px; border-radius:8px; border:1px solid #aaa; margin-bottom:10px; font-size:16px; }
button { padding:10px 20px; border-radius:8px; border:none; background:#396afc; color:white; font-size:16px; cursor:pointer; transition:.2s; }
button:hover{ background:#2948ff; }
#studentList div { background:#f4f6ff; padding:10px; margin:6px 0; border-radius:8px; border-right:5px solid #2948ff; font-weight:bold; }
#adminPanel { display:none; opacity:0; transform:translateY(20px); transition:.4s; }
#adminPanel.show{ display:block; opacity:1; transform:translateY(0); }
.editBox { display:flex; gap:5px; margin-bottom:8px; }
.editBox input{ flex:1; }
</style>
</head>
<body>

<h1 id="secretTitle">ğŸ“˜ Ù…Ø¯Ø±Ø³Ø© Ø¹Ù…Ø±</h1>

<div class="container">
<h2>ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
<input id="studentName" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§">
<button onclick="addStudent()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø§Ø³Ù…</button>
<h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†: <span id="count">0</span></h3>
<h3>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</h3>
<div id="studentList"></div>

<div id="adminPanel">
<hr>
<h2>âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
<button onclick="exportExcel()">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø¥Ù„Ù‰ Excel (XLSX)</button>
<h3>ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø£Ø³Ù…Ø§Ø¡:</h3>
<div id="adminList"></div>
<hr>
<h3>ğŸ”‘ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
<input id="newPass" type="text" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
<button onclick="changePassword()">Ø­ÙØ¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
</div>
</div>

<script>
// ================= Supabase Setup =================
const SUPABASE_URL = "https://ozwjimsaiqtawaergzkn.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im96d2ppbXNhaXF0YXdhZXJnemtuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2MjU3MDIsImV4cCI6MjA3OTIwMTcwMn0.auth4TLnHTzOygdMMayIsLAFOy8h9t0ixsOcV9i8Alg";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// ================= Ø§Ù„ÙˆØ¸Ø§Ø¦Ù =================

// Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ¹Ø¯Ø§Ø¯Ù‡Ù…
async function displayStudents(){
  const { data, error } = await supabase.from('students').select('*').order('created_at',{ascending:true});
  if(error) return console.error(error);

  let list = document.getElementById("studentList");
  list.innerHTML = "";
  data.forEach(s=>{
    list.innerHTML += `<div>${s.name}<br><small>${s.created_at}</small></div>`;
  });
  document.getElementById("count").textContent = data.length;
}

// Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨
async function addStudent(){
  let name = document.getElementById("studentName").value.trim();
  if(!name) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…");

  const { error } = await supabase.from('students').insert([{name}]);
  if(error) return alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: "+error.message);
  document.getElementById("studentName").value="";
  displayStudents();
}

// ================= Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† =================

// Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†
async function displayAdminList(){
  const { data, error } = await supabase.from('students').select('*').order('created_at',{ascending:true});
  if(error) return console.error(error);

  let list = document.getElementById("adminList");
  list.innerHTML="";
  data.forEach(s=>{
    list.innerHTML += `<div class="editBox">
      <input id="edit_${s.id}" value="${s.name}">
      <button onclick="editStudent('${s.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
      <button onclick="deleteStudent('${s.id}')" style="background:red">Ø­Ø°Ù</button>
    </div>`;
  });
}

// ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø·Ø§Ù„Ø¨
async function editStudent(id){
  let newName = document.getElementById("edit_"+id).value.trim();
  if(!newName) return alert("Ø§Ù„Ø§Ø³Ù… ÙØ§Ø±Øº");
  const { error } = await supabase.from('students').update({name:newName}).eq('id',id);
  if(error) return alert(error.message);
  displayStudents();
  displayAdminList();
}

// Ø­Ø°Ù Ø·Ø§Ù„Ø¨
async function deleteStudent(id){
  if(!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù…ØŸ")) return;
  const { error } = await supabase.from('students').delete().eq('id',id);
  if(error) return alert(error.message);
  displayStudents();
  displayAdminList();
}

// ØªØµØ¯ÙŠØ± Excel
async function exportExcel(){
  const { data, error } = await supabase.from('students').select('*').order('created_at',{ascending:true});
  if(error) return alert(error.message);
  let excelData = data.map((s,i)=>({ "Ø§Ù„Ø±Ù‚Ù…": i+1, "Ø§Ù„Ø§Ø³Ù…": s.name, "ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„": s.created_at }));
  let ws = XLSX.utils.json_to_sheet(excelData);
  let wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Ø§Ù„Ø·Ù„Ø§Ø¨");
  XLSX.writeFile(wb,"Ø§Ø³Ù…Ø§Ø¡_Ù…Ø¯Ø±Ø³Ø©_Ø¹Ù…Ø±.xlsx");
}

// ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø£Ø¯Ù…Ù†
async function changePassword(){
  let newP = document.getElementById("newPass").value.trim();
  if(!newP) return alert("Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©");

  const { data, error } = await supabase.from('admin').select('*').limit(1);
  if(error) return alert(error.message);

  const id = data[0].id;
  const { error: updateErr } = await supabase.from('admin').update({password:newP}).eq('id',id);
  if(updateErr) return alert(updateErr.message);

  alert("âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­");
  document.getElementById("newPass").value="";
}

// ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†
async function adminLogin(){
  let pass = prompt("ğŸ” Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
  const { data, error } = await supabase.from('admin').select('*').limit(1);
  if(error) return alert(error.message);

  if(data[0].password === pass){
    document.getElementById("adminPanel").classList.add("show");
    displayAdminList();
  }else{
    alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!");
  }
}

// ================= Ø·Ø±ÙŠÙ‚Ø© Ø³Ø±ÙŠØ© Ù„Ù„Ø¯Ø®ÙˆÙ„ =================
let clicks=0;
document.getElementById("secretTitle").onclick=function(){
  clicks++;
  if(clicks>=5){
    adminLogin();
    clicks=0;
  }
}

// ================= ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ =================
displayStudents();

</script>
</body>
</html>
